package com.datalingo.one.service.impl;

import com.datalingo.one.dto.QueryRequest;
import com.datalingo.one.dto.QueryResponse;
import com.datalingo.one.service.DataSourceService;
import com.datalingo.one.service.QueryExecutorService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.Map;

@Service
public class DataSourceServiceImpl implements DataSourceService {

    private final Map<String, QueryExecutorService> executorMap;

    @Autowired
    public DataSourceServiceImpl(
        PostgresQueryExecutor postgresExecutor,
        MySQLQueryExecutor mysqlExecutor,
        MongoQueryExecutor mongoExecutor
    ) {
        this.executorMap = Map.of(
            "POSTGRES", postgresExecutor,
            "MYSQL", mysqlExecutor,
            "MONGODB", mongoExecutor
        );
    }

    @Override
    public QueryResponse executeQuery(QueryRequest request) {
        String dataSource = request.getDataSource().toUpperCase();

        QueryExecutorService executor = executorMap.get(dataSource);
        if (executor == null) {
            throw new IllegalArgumentException("Unsupported data source: " + dataSource);
        }

        return executor.executeQuery(request);
    }
}
