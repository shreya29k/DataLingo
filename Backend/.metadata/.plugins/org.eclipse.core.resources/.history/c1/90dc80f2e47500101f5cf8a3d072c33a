package com.datalingo.one.util;

public class DatabaseTableCreator {
	public void createTableFromSchema(TableSchema schema, List<String[]> dataRows) {
	    // Drop table if exists
	    String dropTableSql = "DROP TABLE IF EXISTS " + schema.getTableName();
	    jdbcTemplate.execute(dropTableSql);
	    
	    // Create table
	    StringBuilder createTableSql = new StringBuilder();
	    createTableSql.append("CREATE TABLE ").append(schema.getTableName()).append(" (");
	    createTableSql.append("id BIGINT AUTO_INCREMENT PRIMARY KEY, ");
	    
	    StringJoiner columnJoiner = new StringJoiner(", ");
	    for (TableSchema.ColumnInfo column : schema.getColumns()) {
	        columnJoiner.add(column.getName() + " " + column.getDataType());
	    }
	    
	    createTableSql.append(columnJoiner.toString()).append(")");
	    
	    jdbcTemplate.execute(createTableSql.toString());
	    
	    // Insert data
	    if (!dataRows.isEmpty()) {
	        insertDataIntoTable(schema.getTableName(), schema.getColumns(), dataRows);
	    }
	}

}
